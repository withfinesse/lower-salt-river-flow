<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lower Salt River Conditions</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; background-color: #0d1b2a; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; color: #e0e0e0; transition: background 0.3s, color 0.3s; }
    .header h1 { font-size: 2.8rem; margin: 0; letter-spacing: 1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); }
    body.light-mode { background-color: #E8F6F3; color: #2F4F4F; }
    body.light-mode .header h1 { color: #2F4F4F; text-shadow: 1px 1px 2px rgba(255,255,255,0.6); }
    body.light-mode .header, body.light-mode .footer { background-color: #2E8B57; color: white; }
    body.light-mode .container { background: #FCFCFA; color: #2F4F4F; box-shadow: 0 4px 8px rgba(46,139,87,0.1); }
    body.light-mode .data-item { background: white; border: 1px solid #A9D5C2; color: #2F4F4F; }
    body.light-mode .data-item:hover, body.light-mode .data-item:focus-within { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(46,139,87,0.3); }
    body.light-mode .update-section { background: #FCFCFA; border: 1px solid #A9D5C2; color: #2F4F4F; box-shadow: 0 2px 4px rgba(46,139,87,0.1); }
    body.light-mode .update-section h6 { color: #5F7D6B; }
    .header, .footer { background-color: #1b263b; color: #e0e0e0; padding: 20px 0; text-align: center; width: 100%; position: relative; }
    .version { position: absolute; top: 18px; left: 20px; font-size: 0.9em; color: #7f8c8d; transition: color 0.3s; }
    body.light-mode .version { color: white; }
    #theme-toggle { position: absolute; top: 18px; right: 20px; background: transparent; border: 1px solid currentColor; border-radius: 5px; padding: 5px 10px; cursor: pointer; color: inherit; font-size: 0.9em; }
    .container { background: #14213d; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); text-align: center; margin: 20px; width: 90%; max-width: 600px; transition: background 0.3s, box-shadow 0.3s; }
    .data-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 20px; margin-bottom: 20px; }
    .data-item { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:10px; border:1px solid #415a77; border-radius:10px; background:#1f2a44; transition: transform 0.2s, box-shadow 0.2s; }
    .data-item:hover, .data-item:focus-within { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(224,224,224,0.2); }
    .icon { font-size:2em; margin-bottom:10px; }
    .update-section { background: #1f2a44; padding: 15px; border-radius: 10px; text-align: center; width: 90%; max-width: 600px; margin: 0 auto 20px; transition: background 0.3s; }
    .update-section h6 { margin:5px 0; color:#a3b8cc; transition: color 0.3s; }
  </style>
</head>
<body>
  <header class="header">
    <div class="version">v5.8.1</div>
    <h1>Lower Salt River Conditions</h1>
    <button id="theme-toggle">Light Mode</button>
  </header>
  <main class="container">
    <div class="data-grid">
      <div class="data-item"><div class="icon">üíß</div><strong>Flow Rate</strong><span id="flow-data">Loading...</span></div>
      <div class="data-item"><div class="icon">üìè</div><strong>Gage Height</strong><span id="gage-height">Loading...</span></div>
      <div class="data-item"><div class="icon">üåßÔ∏è</div><strong>Precipitation</strong><span id="precipitation">Loading...</span></div>
      <div class="data-item"><div class="icon">üå°Ô∏è</div><strong>Temperature</strong><span id="temperature">Loading...</span></div>
      <div class="data-item"><div class="icon">üí®</div><strong>Wind Speed</strong><span id="wind-speed">Loading...</span></div>
      <div class="data-item"><div class="icon">üß≠</div><strong>Wind Direction</strong><span id="wind-direction">Loading...</span></div>
      <div class="data-item"><div class="icon">üåÖ</div><strong>Sunrise</strong><span id="sunrise">Loading...</span></div>
      <div class="data-item"><div class="icon">üåá</div><strong>Sunset</strong><span id="sunset">Loading...</span></div>
      <div class="data-item"><div class="icon">‚õÖ</div><strong id="weather-current-title"></strong><span id="weather-current-text">Loading...</span></div>
      <div class="data-item"><div class="icon">‚õÖ</div><strong id="weather-next-title"></strong><span id="weather-next-text">Loading...</span></div>
      <div class="data-item"><div class="icon">üåû</div><strong>UV Index</strong><span id="uv-index">Loading...</span></div>
      <div class="data-item"><div class="icon" id="moon-icon">üåë</div><strong>Moon Cycle</strong><span id="moon-phase">Loading...</span></div>
    </div>
  </main>
  <section class="update-section">
    <h6>Data Last Updated</h6>
    <h6>Flow/Gage Height/Precipitation: <span id="usgs-update-time">Loading...</span></h6>
    <h6>Temp/Wind: <span id="observation-update-time">Loading...</span></h6>
    <h6>Forecast: <span id="weather-update-time">Loading...</span></h6>
  </section>
  <footer class="footer">
    <p>Lower Salt River Conditions</p>
    <a href="https://buymeacoffee.com/arizonajoel" target="_blank" rel="noopener">
      <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height:40px; margin-top:10px;" />
    </a>
  </footer>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      function logDebugMessage(msg) { console.log(msg); }
      const toggleBtn = document.getElementById('theme-toggle');
      const saved = localStorage.getItem('theme');
      if (saved === 'light') { document.body.classList.add('light-mode'); toggleBtn.textContent = 'Dark Mode'; }
      toggleBtn.addEventListener('click', () => {
        document.body.classList.toggle('light-mode');
        if (document.body.classList.contains('light-mode')) { toggleBtn.textContent = 'Dark Mode'; localStorage.setItem('theme','light'); }
        else { toggleBtn.textContent = 'Light Mode'; localStorage.setItem('theme','dark'); }
      });
      function formatDate(date) { return date.toLocaleString('en-US',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',timeZone:'America/Phoenix',timeZoneName:'short'}); }
      function formatTime(date) { return date.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'}); }
      function degreesToCompass(deg) { const dirs=['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW']; return dirs[Math.round(deg/22.5)%16]; }
      const moonEmoji={'New Moon':'üåë','Waxing Crescent':'üåí','First Quarter':'üåì','Waxing Gibbous':'üåî','Full Moon':'üåï','Waning Gibbous':'üåñ','Last Quarter':'üåó','Waning Crescent':'üåò'};
      async function fetchWaterData() { logDebugMessage('Fetching water data...'); try { const resp = await fetch('https://waterservices.usgs.gov/nwis/iv/?format=json&sites=09502000'); const data = await resp.json(); const dis = parseFloat(data.value.timeSeries.find(ts => ts.variable.variableCode[0].value === '00060').values[0].value[0].value); const gh = parseFloat(data.value.timeSeries.find(ts => ts.variable.variableCode[0].value === '00065').values[0].value[0].value); const pr = parseFloat(data.value.timeSeries.find(ts => ts.variable.variableCode[0].value === '00045').values[0].value[0].value); const lt = new Date(data.value.timeSeries[0].values[0].value[0].dateTime); document.getElementById('flow-data').textContent = `${dis} cfs`; document.getElementById('gage-height').textContent = `${gh} ft`; document.getElementById('precipitation').textContent = `${pr} in`; document.getElementById('usgs-update-time').textContent = formatDate(lt); } catch(e) { logDebugMessage('Error fetching water data:' + e); } }
      async function fetchObservationData() { logDebugMessage('Fetching observation data...'); try { const resp = await fetch('https://api.weather.gov/stations/TTBA3/observations/latest'); const data = await resp.json(); const tempF = (data.properties.temperature.value * 9/5) + 32; const wd = data.properties.windDirection.value; const ws = data.properties.windSpeed.value * 0.621371; const ot = new Date(data.properties.timestamp); document.getElementById('temperature').textContent = `${tempF.toFixed(2)} ¬∞F`; document.getElementById('wind-direction').textContent = degreesToCompass(wd); document.getElementById('wind-speed').textContent = `${ws.toFixed(2)} mph`; document.getElementById('observation-update-time').textContent = formatDate(ot); } catch(e) { logDebugMessage('Error fetching observation data:' + e); } }
      async function fetchSunData() { logDebugMessage('Fetching sun data...'); try { const resp = await fetch('https://api.sunrise-sunset.org/json?lat=33.4484&lng=-112.0740&formatted=0'); const data = await resp.json(); const rise = new Date(data.results.sunrise); const set = new Date(data.results.sunset); document.getElementById('sunrise').textContent = formatTime(rise); document.getElementById('sunset').textContent = formatTime(set); } catch(e) { logDebugMessage('Error fetching sun data:' + e); document.getElementById('sunrise').textContent = 'Error'; document.getElementById('sunset').textContent = 'Error'; } }
      async function fetchWeatherData() { logDebugMessage('Fetching weather data...'); try { const resp = await fetch('https://api.weather.gov/zones/forecast/AZZ547/forecast'); const j = await resp.json(); const now = j.properties.periods[0], nxt = j.properties.periods[1], ut = new Date(j.properties.updated); document.getElementById('weather-current-title').textContent = now.name; document.getElementById('weather-current-text').innerHTML = now.detailedForecast; document.getElementById('weather-next-title').textContent = nxt.name; document.getElementById('weather-next-text').innerHTML = nxt.detailedForecast; document.getElementById('weather-update-time').textContent = formatDate(ut); } catch(e) { logDebugMessage('Error fetching weather data:' + e); } }
      async function fetchUVData() {
        try {
          const resp = await fetch(
            'https://api.open-meteo.com/v1/forecast?latitude=33.4484&longitude=-112.0740&daily=uv_index_max&timezone=America%2FPhoenix'
          );
          const data = await resp.json();
          const uvToday = (data.daily && data.daily.uv_index_max && data.daily.uv_index_max.length > 0)
            ? data.daily.uv_index_max[0]
            : null;
          let category = 'N/A';
          if (uvToday !== null) {
            if (uvToday <= 2) category = 'Low';
            else if (uvToday <= 5) category = 'Moderate';
            else if (uvToday <= 7) category = 'High';
            else if (uvToday <= 10) category = 'Very High';
            else category = 'Extreme';
          }
          document.getElementById('uv-index').textContent = category;
        } catch (e) {
          document.getElementById('uv-index').textContent = 'N/A';
        }
      }
      async function fetchMoonPhase() { logDebugMessage('Fetching moon phase...'); try { const ts = Math.floor(Date.now() / 1000); const resp = await fetch(`https://api.farmsense.net/v1/moonphases/?d=${ts}`); const arr = await resp.json(); const ph = arr[0]?.Phase || 'Unknown'; document.getElementById('moon-icon').textContent = moonEmoji[ph] || 'üåë'; document.getElementById('moon-phase').textContent = ph; } catch(e) { logDebugMessage('Error fetching moon phase:' + e); document.getElementById('moon-phase').textContent = 'Error'; } }
      fetchWaterData(); fetchObservationData(); fetchSunData(); fetchWeatherData(); fetchUVData(); fetchMoonPhase();
    });
  </script>
</body>
</html>
